# Tasks Search Endpoint Benchmark - Hot Cache
#
# Tests GET /tasks/search endpoint with warm cache (high hit rate)
#
# Target API features:
#   - PersistentTreeMap for indexed search
#   - Alternative trait for fallback strategies
#   - Redis cache for read-through caching
#
# REQ-SEARCH-BENCH-001: Hot cache scenario with 90% hit rate

name: "tasks_search_hot"
description: "GET /tasks/search hot cache benchmark"

# Backend configuration (maps to STORAGE_MODE, CACHE_MODE)
storage_mode: postgres
cache_mode: redis

# Workload configuration
load_pattern: read_heavy
cache_state: warm
# data_scale: maps to DATA_SCALE (small=1e2, medium=1e4, large=1e6)
data_scale: large
# payload_variant: maps to PAYLOAD (minimal=small, standard=medium, complex/heavy=large)
payload_variant: standard
# rps_profile: constant=steady, ramp_up_down=ramp, burst=burst
rps_profile: constant

# Load generation (maps to DURATION, THREADS, CONNECTIONS)
duration_seconds: 30
connections: 100
threads: 8
target_rps: 2000
warmup_seconds: 10

# Contention level
contention_level: low

# Target endpoint (first element maps to ENDPOINT)
endpoints:
  - "/tasks/search"

http_methods:
  - "GET"

# Concurrency settings (maps to POOL_SIZES, WORKERS)
concurrency:
  worker_threads: 8
  database_pool_size: 32
  redis_pool_size: 16
  max_connections: 200

# Cache metrics (expected_hit_rate maps to HIT_RATE)
cache_metrics:
  enabled: true
  per_endpoint: true
  track_latency: true
  warmup_requests: 500
  expected_hit_rate: 0.9

# Performance thresholds (REQ-SEARCH-BENCH-001 requirements)
thresholds:
  max_error_rate: 0.01
  p50_latency_ms: 50
  p95_latency_ms: 200
  p99_latency_ms: 400

# Extended metadata for workflow integration
# Keys here map to environment variables:
#   cache_strategy -> CACHE_STRATEGY (read-through|write-through|write-behind)
#   hit_rate -> HIT_RATE override (0|50|90)
#   fail_injection -> FAIL_RATE override (0|0.1|0.5)
#   retry -> RETRY override (true|false)
#   profile -> PROFILE (true|false)
metadata:
  test_type: "endpoint_benchmark"
  endpoint: "GET /tasks/search"
  cache_strategy: "read-through"
  hit_rate: 90
  api_features:
    - PersistentTreeMap
    - Alternative
  tags:
    - tasks
    - search
    - hot-cache
    - persistent-data
